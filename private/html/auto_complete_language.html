<!--
* Name: auto_complete_language.html
* Description: The html and javascript that implements the UI for the auto-complete language selection control.
*
* This comment block will be removed by the plugin before rendering.
*
* Author: Phil Hopper
* Date:   2015-01-18
-->
<input type="text" id="" name="" style="" class="" placeholder="">
<script type="text/javascript">
    jQuery().ready(function() {

        // used to prevent searching while backspacing
        var previousSearch = '';

        jQuery('#id').attr('placeholder', LANG.plugins['translation']['selectLanguage']).on('keyup', function() {

            var textBox = jQuery('#id');

            var textVal = textBox.val();

            if ((textVal.length !== 2) || (textVal === previousSearch)) return;

            previousSearch = textVal;

            textBox.attr('placeholder', LANG.plugins['translation']['loading']);

            var languages = [];
            var request = {type: 'GET', url: 'https://door43.org:9096/?q=' + encodeURIComponent(textVal)};

            jQuery.ajax(request).done(function(data) {

                if (!data.results) return;

                for (var i = 0; i < data.results.length; i++) {

                    var langData = data.results[i];
                    languages.push(langData['ln'] + ' (' + langData['lc'] + ')');
                }

                if (!textBox.hasClass('ui-autocomplete-input')) {
                    textBox.autocomplete({ source: languages });
                }
                else {
                    textBox.autocomplete('option', 'source', languages);
                }

                textBox.autocomplete('search', textVal);

                textBox.attr('placeholder', LANG.plugins['translation']['selectLanguage']);
            });

            /* additional callback script - do not remove this comment */
        });
    });
</script>
